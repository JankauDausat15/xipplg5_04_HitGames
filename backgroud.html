<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üåø Petualangan Anak Rimba üåø</title>
  <style>
    body { margin: 0; overflow: hidden; font-family: 'Trebuchet MS', sans-serif; }

    /* üéÆ Menu Awal */
    #mainMenu {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: url('download.jpeg') no-repeat center center/cover;
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 10;
    }
    .overlay {
      background: rgba(0, 0, 0, 0.5);
      padding: 60px;
      border-radius: 20px;
      text-align: center;
      color: #fff;
      box-shadow: 0 0 25px rgba(0,0,0,0.8);
      animation: fadeIn 2s ease-in-out;
    }
    .overlay h1 {
      font-size: 3.2rem;
      margin-bottom: 40px;
      text-shadow: 3px 3px 6px black;
      letter-spacing: 2px;
    }
    .btn {
      padding: 15px 60px;
      font-size: 1.4rem;
      border: none;
      border-radius: 30px;
      cursor: pointer;
      background: linear-gradient(45deg, #27ae60, #2ecc71);
      color: white;
      font-weight: bold;
      text-transform: uppercase;
      letter-spacing: 2px;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0,0,0,0.5);
    }
    .btn:hover {
      background: linear-gradient(45deg, #2ecc71, #27ae60);
      transform: scale(1.1);
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.9);}
      to { opacity: 1; transform: scale(1);}
    }

    /* üéÆ Canvas Game */
    canvas { display: block; background: #000; }
    #restartBtn, #attackBtn {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      padding: 15px 30px;
      font-size: 20px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      display: none;
      z-index: 5;
    }
    #restartBtn {
      top: 50%;
      background: crimson;
      color: white;
    }
    #restartBtn:hover { background: darkred; }
    #attackBtn {
      bottom: 20px;
      background: gold;
      color: black;
    }
    #attackBtn:hover { background: orange; }

    /* Tombol leaderboard */
    #leaderboardBtn {
      position: absolute;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: gold;
      color: white;
      font-size: 28px;
      border: none;
      cursor: pointer;
      box-shadow: 0px 4px 8px rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 5;
    }
    #leaderboardBtn:hover { background: orange; }
  </style>
</head>
<body>
  <!-- üéÆ Menu Awal -->
  <div id="mainMenu">
    <div class="overlay">
      <h1>üåø Petualangan Anak Rimba üåø</h1>
      <button class="btn" onclick="startGame()">‚ñ∂ Mainkan</button>
    </div>
  </div>

  <!-- üéÆ Game Canvas -->
  <canvas id="gameCanvas"></canvas>
  <button id="restartBtn">Restart</button>
  <button id="attackBtn">‚öîÔ∏è Attack</button>
  <button id="leaderboardBtn" onclick="window.location.href='leaderboard.html'">üèÜ</button>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    const restartBtn = document.getElementById("restartBtn");
    const attackBtn = document.getElementById("attackBtn");
    const leaderboardBtn = document.getElementById("leaderboardBtn");
    const mainMenu = document.getElementById("mainMenu");

    function resizeCanvas() {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    }
    window.addEventListener("resize", resizeCanvas);
    resizeCanvas();

    // Background custom
    const bg = new Image();
    bg.src = "Latar1.PNG"; // latar kamu

    let cameraX, score, hitCooldown, attackCooldown;
    let gameOver = false;
    let totalLives = 3; 
    let bloodEffect = 0;

    // Player
    const playerImg = new Image();
    playerImg.src = "knight.png"; 
    let player;

    // Enemy
    const enemyImg = new Image();
    enemyImg.src = "tiger.png"; 
    let enemies = [];

    // Heart
    const heartImg = new Image();
    heartImg.src = "heart.png"; 

    const keys = {};
    let groundHeight = 180;

    document.addEventListener("keydown", (e) => keys[e.code] = true);
    document.addEventListener("keyup", (e) => {
      keys[e.code] = false;
      if (e.code === "KeyA") player.attacking = false;
    });

    attackBtn.addEventListener("click", () => {
      if (attackCooldown <= 0) {
        player.attacking = true;
        attackCooldown = 30;
      }
    });

    function spawnEnemy() {
      if (enemies.length >= 3) return;
      const enemy = {
        worldX: cameraX + canvas.width + Math.random() * 600,
        width: 100,
        height: 80,
        y: canvas.height - groundHeight - 80,
        hp: 3,
        speed: (Math.random() < 0.5 ? -1 : 1) * (1 + Math.random() * 2)
      };
      enemies.push(enemy);
    }

    function resetGame(resetLives = false) {
      if (resetLives) totalLives = 3;
      cameraX = 0;
      score = 0;
      hitCooldown = 0;
      attackCooldown = 0;
      gameOver = false;
      bloodEffect = 0;
      restartBtn.style.display = "none";
      attackBtn.style.display = "block";
      leaderboardBtn.style.display = "block";
      enemies = [];

      player = {
        x: 200,
        y: canvas.height - groundHeight - 70,
        width: 60,
        height: 70,
        dy: 0,
        speed: 6,
        jumpPower: -15,
        gravity: 0.8,
        onGround: true,
        attacking: false,
        hp: 3
      };

      for (let i = 0; i < 2; i++) spawnEnemy();

      gameLoop();
    }

    function update() {
      if (gameOver) return;

      if (keys["ArrowLeft"]) cameraX -= 5;
      if (keys["ArrowRight"]) cameraX += 5;

      if (keys["Space"] && player.onGround) {
        player.dy = player.jumpPower;
        player.onGround = false;
      }

      player.dy += player.gravity;
      player.y += player.dy;

      let groundY = canvas.height - groundHeight - player.height;
      if (player.y >= groundY) {
        player.y = groundY;
        player.dy = 0;
        player.onGround = true;
      }

      enemies.forEach(enemy => {
        enemy.y = canvas.height - groundHeight - enemy.height;
        enemy.worldX += enemy.speed;
        if (enemy.worldX < cameraX - 200) enemy.speed *= -1;
        if (enemy.worldX > cameraX + canvas.width + 200) enemy.speed *= -1;
      });

      if (player.attacking) {
        let attackRange = {
          x: player.x + player.width,
          y: player.y,
          width: 40,
          height: player.height
        };
        enemies.forEach(enemy => {
          let enemyScreenX = enemy.worldX - cameraX;
          if (
            attackRange.x < enemyScreenX + enemy.width &&
            attackRange.x + attackRange.width > enemyScreenX &&
            attackRange.y < enemy.y + enemy.height &&
            attackRange.y + attackRange.height > enemy.y
          ) {
            enemy.hp -= 1;
            player.attacking = false;
            if (enemy.hp <= 0) {
              score += 50;
              enemies = enemies.filter(e => e !== enemy);
            }
          }
        });
      }

      enemies.forEach(enemy => {
        let enemyScreenX = enemy.worldX - cameraX;
        if (
          player.x < enemyScreenX + enemy.width &&
          player.x + player.width > enemyScreenX &&
          player.y < enemy.y + enemy.height &&
          player.y + player.height > enemy.y
        ) {
          if (hitCooldown <= 0) {
            bloodEffect++;
            hitCooldown = 60;
            if (bloodEffect >= 3) {
              totalLives--;
              bloodEffect = 0;
              if (totalLives <= 0) {
                gameOver = true;
                restartBtn.style.display = "block";
                attackBtn.style.display = "none";
              } else {
                gameOver = true;
                restartBtn.style.display = "block";
                attackBtn.style.display = "none";
              }
            }
          }
        }
      });

      if (hitCooldown > 0) hitCooldown--;
      if (attackCooldown > 0) attackCooldown--;

      if (Math.random() < 0.005 && enemies.length < 3) spawnEnemy();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      let bgWidth = canvas.width;
      let offsetX = -cameraX % bgWidth;
      if (offsetX > 0) offsetX -= bgWidth;
      ctx.drawImage(bg, offsetX, 0, bgWidth, canvas.height);
      ctx.drawImage(bg, offsetX + bgWidth, 0, bgWidth, canvas.height);

      ctx.drawImage(playerImg, player.x, player.y, player.width, player.height);

      enemies.forEach(enemy => {
        let enemyScreenX = enemy.worldX - cameraX;
        if (enemy.hp > 0) {
          ctx.drawImage(enemyImg, enemyScreenX, enemy.y, enemy.width, enemy.height);
          ctx.fillStyle = "red";
          ctx.fillRect(enemyScreenX, enemy.y - 20, enemy.width, 10);
          ctx.fillStyle = "lime";
          ctx.fillRect(enemyScreenX, enemy.y - 20, (enemy.hp / 3) * enemy.width, 10);
        }
      });

      if (player.attacking) {
        ctx.fillStyle = "rgba(255,0,0,0.5)";
        ctx.fillRect(player.x + player.width, player.y, 40, player.height);
      }

      ctx.fillStyle = "white";
      ctx.font = "24px Arial Black";
      ctx.fillText("Score: " + score, 20, 40);

      ctx.font = "40px Arial Black";
      ctx.fillText("LEVEL 0", 20, 80);

      for (let i = 0; i < totalLives; i++) {
        if (heartImg.complete && heartImg.naturalWidth !== 0) {
          ctx.drawImage(heartImg, canvas.width - (i + 1) * 40, 20, 30, 30);
        } else {
          ctx.fillStyle = "red";
          ctx.font = "30px Arial";
          ctx.fillText("‚ù§", canvas.width - (i + 1) * 40, 45);
        }
      }

      if (bloodEffect > 0) {
        ctx.fillStyle = "rgba(255,0,0,0.3)";
        ctx.fillRect(0, 0, canvas.width, canvas.height);
      }

      if (gameOver) {
        ctx.fillStyle = "red";
        ctx.font = "60px Arial Black";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("GAME OVER", canvas.width / 2, canvas.height / 2 - 50);
        ctx.textAlign = "start";
        ctx.textBaseline = "alphabetic";
      }
    }

    function gameLoop() {
      update();
      draw();
      if (!gameOver) requestAnimationFrame(gameLoop);
      else requestAnimationFrame(draw);
    }

    restartBtn.addEventListener("click", () => {
      if (totalLives > 0) {
        resetGame(); 
      } else {
        resetGame(true); 
      }
    });

    // üî• fungsi mulai game dari menu
    function startGame() {
      mainMenu.style.display = "none"; // hilangin menu awal
      resetGame(); // mulai game
    }
  </script>
</body>
</html>
